---
title: "Exploring Homicides"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---
===============================================================================================================

```{r echo=FALSE, message=FALSE, warning=FALSE}
#setwd('/Users/christinacaddel/Desktop/DATA/DAND/part_6/EDA Project')
homicides <- read.csv('homicides.csv')
```

This report explores a dataset containing demographic information and other details of victims and perpetrators in about 640,000 homicides in the United States from 1980-2014. Our dataset consists of 29 variables, with nearly 640,000 observations.

## Univariate Plots Section

```{r warning=FALSE}
#let's get the dimensions of the dataset
dim(homicides)
```

```{r warning=FALSE}
str(homicides)
```

```{r warning=FALSE}
summary(homicides)
```

It looks like for victims, we have nearly 500,000 that are male, 145,000 female, and almost 1,000 unknown. For perpetrators, about 400,000 are male, almost 50,000 female and 190,000 unknown.
```{r warning=FALSE}
summary(homicides$Victim.Sex)
summary(homicides$Perpetrator.Sex)
```

```{r warning=FALSE}
library(ggplot2)
#define individual plots
ggplot(aes(Victim.Age), data = homicides) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits = c(0, 95), breaks = seq(0,95,10))

```
```{r warning=FALSE}
summary(homicides$Victim.Age)
```
The victim age distribution appears to be pretty much unimodal, peaking at ages 20-25. We do have a little spike in homicides for victims aged 0-1.

```{r warning=FALSE}
library(gridExtra)
#define individual plots
p1 <- ggplot(aes(Perpetrator.Age), data = homicides) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(breaks = seq(0,90,10))

p2 <- p1 + scale_x_log10()

#arrange plots in grid
grid.arrange(p1, p2, ncol = 1)
```

```{r warning=FALSE}
#define individual plots
ggplot(aes(Perpetrator.Age), data = homicides) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits = c(10, 90),breaks = seq(10,90,10))
```
```{r warning=FALSE}
summary(homicides$Perpetrator.Age)
```
After transforming the long tail data for perpetrator age into log scale as well as limiting the axes for potentially erroneous data entries, we see a still somewhat skewed, unimodal distribution. Perpetrator age peaks at 20.

```{r warning=FALSE}
qplot(x = Perpetrator.Age, y = ..count../sum(..count..),
      data = homicides,
      geom = 'freqpoly', color = Crime.Solved) +
  scale_x_continuous(breaks = c(0,100,10))
```

It appears that there is a large number of entries in which the Perpetrator Age is 0, and nearly all of them are unsolved homicides. It might be safe to say that for any crime where the perpetrators are not known, they input the value of 0 for perpetrators' age. Might make sense to apply x axis limit to remove 0 values.

```{r warning=FALSE}
#number of homicides per year over the years
qplot(x = Year, data = homicides, binwidth = .99, color = I('black'), fill = I('#099DD9'))
```

Homicide occurrences peaked between 1990-1995. Occurrences lowered in the late '90s - 2000 and have not reached 1980's & 1990's levels since then.

```{r warning=FALSE}
#re-organize factors in month column to be sequential months of the year
homicides$Month <- factor(homicides$Month, levels = c('January','February','March','April','May','June','July','August','September','October','November','December'))

#plot monthly homicide volume faceted by year
p1 <- qplot(x = Month, data = subset(homicides, Year == 1980 | Year == 1981 | Year == 1982 | 
                                       Year == 1983 | Year == 1984 | Year == 1985)) +
  theme(text = element_text(size=9), axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ Year, ncol = 6) +
  scale_x_discrete(labels = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

p2 <- qplot(x = Month, data = subset(homicides, Year == 1986 | Year == 1987 | Year == 1988 | 
                                       Year == 1989 | Year == 1990 | Year == 1991)) +
  theme(text = element_text(size=9), axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ Year, ncol = 6) +
  scale_x_discrete(labels = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

grid.arrange(p1, p2, ncol = 1)
```
```{r warning=FALSE}
#re-organize factors in month column to be sequential months of the year
homicides$Month <- factor(homicides$Month, levels = c('January','February','March','April','May','June','July','August','September','October','November','December'))

#plot monthly homicide volume faceted by year
p1 <- qplot(x = Month, data = subset(homicides, Year == 1992 | Year == 1993 | Year == 1994 | 
                                       Year == 1995 | Year == 1996 | Year == 1997)) +
  theme(text = element_text(size=9), axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ Year, ncol = 6) +
  scale_x_discrete(labels = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

p2 <- qplot(x = Month, data = subset(homicides, Year == 1998 | Year == 1999 | Year == 2000 | 
                                       Year == 2001 | Year == 2002 | Year == 2003)) +
  theme(text = element_text(size=9), axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ Year, ncol = 6) +
  scale_x_discrete(labels = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

grid.arrange(p1, p2, ncol = 1)
```

```{r warning=FALSE}
#re-organize factors in month column to be sequential months of the year
homicides$Month <- factor(homicides$Month, levels = c('January','February','March','April','May','June','July','August','September','October','November','December'))

#plot monthly homicide volume faceted by year
p1 <- qplot(x = Month, data = subset(homicides, Year == 2004 | Year == 2005 | Year == 2006 | 
                                       Year == 2007 | Year == 2008 | Year == 2009)) +
  theme(text = element_text(size=9), axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ Year, ncol = 6) +
  scale_x_discrete(labels = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

p2 <- qplot(x = Month, data = subset(homicides, Year == 2010 | Year == 2011 | Year == 2012 | 
                                       Year == 2013 | Year == 2014)) +
  theme(text = element_text(size=9), axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ Year, ncol = 6) +
  scale_x_discrete(labels = c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))

grid.arrange(p1, p2, ncol = 1)
```

Looking at monthly homicide rates faceted over the years, we see that from 2010 onward, not one month of the year has over 1500 homicides. As for where homicide rates peak per year, it varies widely across all months of the year. 

```{r warning=FALSE}
homicides$Month <- factor(homicides$Month, levels = c('January','February','March','April','May','June','July','August','September','October','November','December'))

ggplot(aes(Month), data = homicides) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 75))
```

In aggregate, it looks like the month of July has the most homicides, with August coming in at a close second.

```{r warning=FALSE}
summary(homicides$Relationship)
```
Let's group Relationship categories further into: Stranger/Unknown perpetrator, Friend/Neighbor/Acquaintance, Boyfriend/Girlfriend, Child/Stepchild, Extended-Family, Parent/Stepparent, Spouse/Ex-spouse, Sibling, Employer/employee.

```{r warning=FALSE}
#create new column 'Relation' to place factors from 'Relationship' column into buckets
homicides$Relation <- ifelse(homicides$Relationship == 'Acquaintance' | homicides$Relationship == 'Neighbor' | 
                               homicides$Relationship == 'Friend', 'Friend/Neighbor/Acquaintance', 
ifelse(homicides$Relationship == 'Boyfriend' | homicides$Relationship == 'Boyfriend/Girlfriend' | 
         homicides$Relationship == 'Girlfriend', 'Boyfriend/Girlfriend',
ifelse(homicides$Relationship == 'Brother' | homicides$Relationship == 'Sister', 'Sibling',
ifelse(homicides$Relationship == 'Common-Law Husband' | homicides$Relationship == 'Common-Law Wife' | 
         homicides$Relationship == 'Ex-Husband' | homicides$Relationship == 'Ex-Wife', 'Spouse/Ex-Spouse',
ifelse(homicides$Relationship == 'Daughter'| homicides$Relationship == 'Son' | homicides$Relationship == 'Stepdaughter' | homicides$Relationship == 'Stepson', 'Child/Stepchild',
       ifelse(homicides$Relationship == 'Employee' | homicides$Relationship == 'Employer','Employee/Employer',
       ifelse(homicides$Relationship == 'Family' | homicides$Relationship == 'In-Law','Extended.Family',
              ifelse(homicides$Relationship == 'Father' | homicides$Relationship == 'Mother' | 
                       homicides$Relationship == 'Stepfather' | homicides$Relationship == 'Stepmother','Parent/Stepparent', 'Stranger/Unknown'))))))))

#convert Relation column to factor type
homicides$Relation <- factor(homicides$Relation)

#reorder factors in Relation for graph below to be in descending order
homicides$Relation <- with(homicides, reorder(Relation, Relation, function(x) -length(x)))

#graph Relation category of homicides based on percentage of total
ggplot(aes(x = Relation), data = homicides) +
  geom_bar(aes(y = ..count../(sum(..count..))), fill = I('#099DD9')) +
  theme(text = element_text(size=10), axis.text.x = element_text(angle = 70)) +
  scale_y_continuous(labels = scales::percent)
```

Homicides committed by someone unknown or a stranger to the victim are the highest, accounting for slightly over 60% of all homicides in the dataset. Next most common is those committed by a friend, neighbor or acquaintance to the victim - accounting for a little over 20% of all homicides in the dataset. In all, over 80% of homicides are committed by someone the victim either didn't know, or was not super close to.

```{r warning=FALSE}
ggplot(aes(Relation), data = homicides) +
  theme(text = element_text(size=10),axis.text.x = element_text(angle = 90)) +
  geom_bar()
```

When looking at counts of homicides by relation, we see a similar trend as when looking at percentages of total.

```{r warning=FALSE}
homicides <- within(homicides, 
                   Agency.Type <- factor(Agency.Type, 
                                      levels=names(sort(table(Agency.Type), 
                                                        decreasing=TRUE))))

ggplot(aes(Agency.Type), data = homicides) +
  theme(text = element_text(size=10))+
  geom_bar()
```

It looks like by and large, most homicides are under the jurisdiction of municipal police, which is the smallest administrative subdivision.

```{r warning=FALSE}
homicides$Victim.Race <- ifelse(homicides$Victim.Ethnicity == 'Hispanic', 'Hispanic', 
                                ifelse(homicides$Victim.Race == 'Asian/Pacific Islander', 'Asian/Pacific Islander', 
                                       ifelse(homicides$Victim.Race == 'Black', 'Black', 
                                              ifelse(homicides$Victim.Race == 'White', 'White',
                                                     ifelse(homicides$Victim.Race == 'Native American/Alaska Native', 'Native American/Alaska Native',  'Unknown')))))
```
Consolidated so that hispanic data is included in the Victim.Race variable

```{r warning=FALSE}
homicides$Perpetrator.Race <- ifelse(homicides$Perpetrator.Ethnicity == 'Hispanic', 'Hispanic', 
                                ifelse(homicides$Perpetrator.Race == 'Asian/Pacific Islander', 'Asian/Pacific Islander', 
                                       ifelse(homicides$Perpetrator.Race == 'Black', 'Black', 
                                              ifelse(homicides$Perpetrator.Race == 'White', 'White',
                                                     ifelse(homicides$Perpetrator.Race == 'Native American/Alaska Native', 'Native American/Alaska Native', 'Unknown')))))
```
Consolidated so that hispanic data is included in the Perpetrator.Race variable

```{r warning=FALSE}
homicides <- within(homicides, 
                   Victim.Race <- factor(Victim.Race, 
                                      levels=names(sort(table(Victim.Race), 
                                                        decreasing=TRUE))))

ggplot(aes(Victim.Race), data = homicides) +
  theme(text = element_text(size=10))+
  geom_bar()
```

The majority of victims by far are black or white.

```{r warning=FALSE}
homicides <- within(homicides, 
                   Perpetrator.Race <- factor(Perpetrator.Race, 
                                      levels=names(sort(table(Perpetrator.Race), 
                                                        decreasing=TRUE))))

ggplot(aes(Perpetrator.Race), data = homicides) +
  geom_bar() +
  theme(text = element_text(size=10))
```

The number of black perpetrators is highest, with white perpetrator counts coming in second.

```{r warning=FALSE}
summary(homicides$Weapon)
```

Some of the weapon categories are pretty similar, so let's adjust the Weapon variable to group some of them together.

```{r warning=FALSE}
#Place factors from 'Weapon' column into buckets
homicides$Weapon <- ifelse(homicides$Weapon == 'Firearm' | homicides$Weapon == 'Shotgun' | homicides$Weapon == 'Rifle' | homicides$Weapon == 'Gun', 'Other Firearm', 
                           ifelse(homicides$Weapon == 'Knife', 'Knife', 
                                  ifelse(homicides$Weapon == 'Blunt Object', 'Blunt Object', 
                                         ifelse(homicides$Weapon == 'Unknown', 'Unknown', 
                                                ifelse(homicides$Weapon == 'Strangulation', 'Strangulation',
                                                       ifelse(homicides$Weapon == 'Fire', 'Fire',
                                                              ifelse(homicides$Weapon == 'Suffocation', 'Suffocation',
                                                                     ifelse(homicides$Weapon == 'Drugs', 'Drugs',
                                                                            ifelse(homicides$Weapon == 'Drowning', 'Drowning',
                                                                                   ifelse(homicides$Weapon == 'Explosives', 'Explosives',
                                                                                          ifelse(homicides$Weapon == 'Poison', 'Poison',
                                                                                                 ifelse(homicides$Weapon == 'Fall', 'Fall', 'Handgun'))))))))))))

homicides <- within(homicides, 
                   Weapon <- factor(Weapon, 
                                      levels=names(sort(table(Weapon), 
                                                        decreasing=TRUE))))
ggplot(aes(Weapon), data = homicides) +
  geom_bar() +
  theme(text = element_text(size=10), axis.text.x = element_text(angle = 70))
```


```{r warning=FALSE}
ggplot(aes(Victim.Age), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits = c(0, 95), breaks = seq(0,95,10)) +
  facet_wrap( ~ Victim.Sex)
```

Looking at victim age faceted by gender, females peak at 20-30 years old and males peak at around 20 years old. We see for both genders another little peak in the 0-5 age range.

```{r warning=FALSE}
ggplot(aes(Perpetrator.Age), data = subset(homicides, 
                                           Perpetrator.Sex == 'Female' | Perpetrator.Sex == 'Male')) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits = c(5, 90), breaks = seq(5,90,10)) +
  facet_wrap( ~ Perpetrator.Sex)
```

Looking at perpetrator age faceted by male and female, they peak at 20-25 for females, and at around 20 for males.

```{r warning=FALSE}
qplot(x = Victim.Age, y = ..count../sum(..count..),
      data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male'),
      ylab = 'Proportion of Victims that Age',
      geom = 'freqpoly', color = Victim.Sex) +
  scale_x_continuous(lim = c(0, 90), breaks = seq(0,90,10))
```

Looking at victim ages by sex as a proportion of all homicides in the dataset, we see that male victims aged 20-25 take the highest rate, at over 8% of all homicides.

```{r warning=FALSE}
qplot(x = Perpetrator.Age, y = ..count../sum(..count..),
      data = subset(homicides, Perpetrator.Sex == 'Female' | Perpetrator.Sex == 'Male'),
      ylab = 'Proportion of Perps that Age',
      geom = 'freqpoly', color = Perpetrator.Sex) +
  scale_x_continuous(lim = c(5, 90), breaks = seq(5,90,10))
```

Looking at perpetrator ages by gender as a percentage of all homicides, we see two peaks. Males aged about 17/18 taking about 12% of all homicides, and males aged about 23/24 taking about 11% of all homicides.

```{r warning=FALSE}
qplot(x = Victim.Age, y = ..count../sum(..count..),
      data = subset(homicides, Perpetrator.Sex == 'Female' | Perpetrator.Sex == 'Male'),
      ylab = 'Proportion perps killing someone that age',
      geom = 'freqpoly', color = Perpetrator.Sex) +
  scale_x_continuous(lim = c(0, 90), breaks = seq(0,90,10))
```

Male perpetrators killing victims aged 20-25 peak at between 9-10% of all cases.

```{r warning=FALSE}
p1 <- qplot(x = Year,
            data = homicides,
            geom = 'freqpoly', color = Crime.Solved)
p2 <- qplot(x = Year, y = ..count../sum(..count..),
            data = homicides,
            geom = 'freqpoly', color = Crime.Solved)

grid.arrange(p1, p2, ncol = 1)
```

It looks like the rate of solving crimes is at all times higher than the rate of non-solved homicides.

```{r warning=FALSE}
qplot(x = Victim.Age,
      data = homicides,
      geom = 'freqpoly', color = Crime.Solved) +
  scale_x_continuous(lim = c(0, 90), breaks = seq(0,90,10))
```

The rate of solving crimes is at all victim ages higher than the rate of non-solved homicides. The difference between solved and non-solved is closest at victims aged about 12-13.

```{r warning=FALSE}
p1 <- qplot(x = Victim.Age,
            data = subset(homicides, Victim.Sex == 'Female'),
            xlab = 'Age - Female Victim',
            geom = 'freqpoly', color = Crime.Solved) +
  scale_x_continuous(lim = c(0, 90), breaks = seq(0,90,10))

p2 <- qplot(x = Victim.Age,
            data = subset(homicides, Victim.Sex == 'Male'),
            xlab = 'Age - Male Victim',
            geom = 'freqpoly', color = Crime.Solved) +
  scale_x_continuous(lim = c(0, 90), breaks = seq(0,90,10))

grid.arrange(p1, p2, ncol = 1)
```

When looking at solved crime rated between male and female victims, we see overall a smaller difference between solved and non-solved rates in male victims. 

```{r warning=FALSE}
p1 <- qplot(x = Victim.Age,
            data = subset(homicides, Victim.Sex == 'Female' & Perpetrator.Sex != 'Unknown'),
            xlab = 'Age - Female Victim',
            binwidth = 10, geom = 'freqpoly', color = Perpetrator.Sex) +
  scale_x_continuous(lim = c(0, 90), breaks = seq(0,90,10))

p2 <- qplot(x = Victim.Age,
            data = subset(homicides, Victim.Sex == 'Male' & Perpetrator.Sex != 'Unknown'),
            xlab = 'Age - Male Victim',
            binwidth = 10, geom = 'freqpoly', color = Perpetrator.Sex) +
  scale_x_continuous(lim = c(0, 90), breaks = seq(0,90,10))

grid.arrange(p1, p2, ncol = 1)
```

Above, we see that both female and male victims are far more often killed by a male perpetrator. 

```{r warning=FALSE}
by(homicides$Victim.Age, homicides$Victim.Sex, summary)
```

Female victims have a median age of 32, and male victims have a median age of 29. There is also clearly some erroneous data. Let's get rid of Victim ages above 99 and perpetrator ages below 5.

```{r warning=FALSE}
#control for erroneous victim and perpetrator ages in dataset
homicides <- subset(homicides, Victim.Age < 99 & Perpetrator.Age > 5)
```

```{r warning=FALSE}
by(homicides$Victim.Age, homicides$Victim.Sex, summary)
```

```{r warning=FALSE}
by(homicides$Perpetrator.Age, homicides$Perpetrator.Sex, summary)
```

```{r warning=FALSE}
homicides$State.Pop <- ifelse(homicides$State == 'Alabama', as.integer(4863000), 
                              ifelse(homicides$State == 'Alaska', as.integer(741894),
                                     ifelse(homicides$State == 'Arkansas', as.integer(2988000),
                                            ifelse(homicides$State == 'Arizona', as.integer(6931000),
                                                   ifelse(homicides$State == 'Georgia', as.integer(10310000),
                                                          ifelse(homicides$State == 'Wyoming', as.integer(585501),
                                                                 ifelse(homicides$State == 'Wisconsin', as.integer(5779000),
                                                                        ifelse(homicides$State == 'Washington', as.integer(7288000),
                                                                               ifelse(homicides$State == 'West Virginia', as.integer(1831000),
                                                                                      ifelse(homicides$State == 'Virginia', as.integer(8412000),
                                                                                             ifelse(homicides$State == 'Utah', as.integer(3051000),
                                                                                                    ifelse(homicides$State == 'Tennessee', as.integer(6651000), 
                                                                                                           ifelse(homicides$State == 'Texas', as.integer(27860000), 
                                                                                                                  ifelse(homicides$State == 'Vermont', as.integer(624594),
                                                                                                                                                ifelse(homicides$State == 'South Carolina', as.integer(4961000),
                                                                                                                                                       ifelse(homicides$State == 'South Dakota', as.integer(865454),
                                                                                                                                                              ifelse(homicides$State == 'Rhode Island', as.integer(1056000),
                                                                                                                                                                     ifelse(homicides$State == 'Pennsylvania', as.integer(12780000),
                                                                                                                                                                            ifelse(homicides$State == 'Oklahoma', as.integer(3924000),
                                                                                                                                                                                   ifelse(homicides$State == 'Ohio', as.integer(11610000),
                                                                                                                                                                                          ifelse(homicides$State == 'Oregon', as.integer(4093000),
                                                                                                                                                                                                 ifelse(homicides$State == 'Massachusetts', as.integer(6812000),
                                                                                                                                                                                                        ifelse(homicides$State == 'North Dakota', as.integer(757952),
                                                                                                                                                                                                               ifelse(homicides$State == 'North Carolina', as.integer(10150000),
                                                                                                                                                                                                                      ifelse(homicides$State == 'New Mexico', as.integer(2081000),
                                                                                                                                                                                                                             ifelse(homicides$State == 'Nebraska', as.integer(1907000),
                                                                                                                                                                                                                                    ifelse(homicides$State == 'New York', as.integer(19750000),
                                                                                                                                                                                                                                           ifelse(homicides$State == 'New Hampshire', as.integer(1335000),
                                                                                                                                                                                                                                                  ifelse(homicides$State == 'Nevada', as.integer(2940000),
                                                                                                                                                                                                                                                         ifelse(homicides$State == 'Missouri', as.integer(6093000),
                                                                                                                                                                                                                                                                ifelse(homicides$State == 'Minnesota', as.integer(5520000),
                                                                                                                                                                                                                                                                       ifelse(homicides$State == 'Maine', as.integer(1331000),
                                                                                                                                                                                                                                                                              ifelse(homicides$State == 'Montana', as.integer(1043000),
                                                                                                                                                                                                                                                                                     ifelse(homicides$State == 'Mississippi', as.integer(2989000),
                                                                                                                                                                                                                                                                                            ifelse(homicides$State == 'Michigan', as.integer(9928000), 
                                                                                                                                                                                                                                                                                                   ifelse(homicides$State == 'Maryland', as.integer(6016000), 
                                                                                                                                                                                                                                                                                                          ifelse(homicides$State == 'Louisiana', as.integer(4682000), 
                                                                                                                                                                                                                                                                                                                 ifelse(homicides$State == 'Kentucky', as.integer(4437000), 
                                                                                                                                                                                                                                                                                                                        ifelse(homicides$State == 'Kansas', as.integer(2907000),
                                                                                                                                                                                                                                                                                                                               ifelse(homicides$State == 'Indiana', as.integer(6633000),
                                                                                                                                                                                                                                                                                                                                      ifelse(homicides$State == 'Illinois', as.integer(12800000),
                                                                                                                                                                                                                                                                                                                                             ifelse(homicides$State == 'Idaho', as.integer(1683000),
                                                                                                                                                                                                                                                                                                                                                    ifelse(homicides$State == 'Iowa', as.integer(3135000),
                                                                                                                                                                                                                                                                                                                                                           ifelse(homicides$State == 'Hawaii', as.integer(1429000),
                                                                                                                                                                                                                                                                                                                                                                  ifelse(homicides$State == 'Florida', as.integer(20610000),
                                                                                                                                                                                                                                                                                                                                                                         ifelse(homicides$State == 'Delaware', as.integer(952065),
                                                                                                                                                                                                                                                                                                                                                                                ifelse(homicides$State == 'Connecticut', as.integer(3576000),
                                                                                                                                                                                                                                                                                                                                                                                       ifelse(homicides$State == 'California', as.integer(39250000),
                                                                                                                                                                                                                                                                                                                                                                                              ifelse(homicides$State == 'Colorado', as.integer(5541000),(8944000))))))))))))))))))))))))))))))))))))))))))))))))))

```

```{r warning=FALSE}
#another quantitative variable
summary(homicides$State.Pop)
```
I added a variable of state populations, State.Pop

```{r warning=FALSE}
#another quantitative variable
homicides$age_diff <- homicides$Perpetrator.Age - homicides$Victim.Age
summary(homicides$age_diff)
```
I added another quantitative variable of age difference between victim and perpetrator

## Univariate Analysis

### What is the structure of your dataset?

There are close to 638,450 homicides in the dataset with 24 details for each case (agency, location, time, solved or not, victim and perpetrator demographics, relationship between victim and perpetrator, weapon used, and some other details we won't really need for our analysis). 

Some observations:
 - Most victims are male
 - Most perpetrators are male
 - The median victim age is 30
 - The median perpetrator age is 21
 - Over 60% of homicides are committed by an unknown perpetrator, or one that is a stranger to the victim
 
### What are the main features of interest in your dataset?

The main features of this dataset are Victim.Age and Perpetrator.Age. I'd like to understand trends that may exist in who is killing who. I believe that a combination of certain contextual factors to the crime have something to do with the patterns we see in homicides.

### What other features in the dataset do you think will help support your investigation into your features of interest?

Victim.Sex, Perpetrator.Sex, Victim.Race, Perpetrator.Race, Relationship, Month, and City/State likely contribute to any trends we see in homicide levels. Other things like weapon used, I also believe have marginal insights to offer. Relationship and gender I believe have the biggest influences on homicide rates at certain ages for both victim and perpetrator.

### Did you create any new variables in the dataset?

I created a variable for state populations so that as we investigate further, we can explore based upon homicide rates by state and control for homicides as a percentage of total population. Some argue whether homicides take place more in rural or urban areas, so it would be interesting to look at things from this angle.

I also noticed that 'Hispanic' as a race is not included in the race variable for either victim or perpetrator. Instead it had it's own variable that wouldn't make things very seamless in the analysis. I consolidated so that 'hispanic' is included as a factor in the race variable for both victims and perpetrators. In considering whether one is hispanic, regardless of whether they are white, black, etc. I believe that the culture aspects of being hispanic play a larger role in their involvement in homicide than the color of their skin.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

We saw that in perpetrator ages, often an unsolved homicide (in which, by definition the perpetrator is unknown) will record it at age 0. For this reason, we will control in our analyses for perpetrators aged over 5. 

We also saw that in victim ages, the impossible number of 998 exists. This is clearly an error or an automatic entry when for whatever reason, the victim is unknown. Overall, we will control for victims aged under 90 or 95.

## Bivariate Plots

```{r warning=FALSE}
#install.packages('GGally')
library(GGally)

#install.packages('reshape2')
library(reshape2)

#install.packages("dplyr")
library(dplyr)

#install.packages('RColorBrewer')
library(RColorBrewer)
```

```{r warning=FALSE}

theme_set(theme_minimal(20))

#set seed to get reproducible results
set.seed(1836)
homicides_subset <- homicides[c("Year","Incident","Victim.Age","Perpetrator.Age","age_diff")]
names(homicides_subset)

```

```{r warning=FALSE}
#create plot matrix
ggpairs(homicides_subset[sample.int(nrow(homicides_subset), 1000), ]) +
  theme(text = element_text(size = 9))
```

From this plot matrix, age differences seem to have strong correlations with victim and perpetrator ages. Let's take a closer look at the relationships between the ages of those involved in homicides.

```{r warning=FALSE}
qplot(x = Victim.Sex, y = Victim.Age,
      data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male' & Victim.Age < 100),
      geom = 'boxplot', ylim = c(0,60))
```

Both male and female victims for the most part range in age from 20 to 40, with males typically being just slightly younger than females.

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = Perpetrator.Sex, y = Perpetrator.Age,
      data = subset(homicides, Perpetrator.Sex == 'Female' | 
                      Perpetrator.Sex == 'Male' & Perpetrator.Age > 5 & Perpetrator.Age < 100),
      geom = 'boxplot', ylim = c(5,60))
```

Both male and female perpetrators for the most part range in age from 20 to 40, with females typically being slightly older than males.

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(x = Perpetrator.Sex, y = Victim.Age,
      data = subset(homicides, Perpetrator.Sex == 'Female' | 
                      Perpetrator.Sex == 'Male' & Victim.Age < 100),
      geom = 'boxplot', ylim = c(0,60))
```

When looking at victim age based on perpetrator sex, we don't see much of a difference between the two. We just see that for female perpetrators, victim age has a slightly larger inter quartile range, from 20 to just over 40. And for male perpetrators, victims inter quartile age range is from early 20s to late 30s.

```{r warning=FALSE}
qplot(x = Victim.Sex, y = Perpetrator.Age,
      data = subset(homicides, Victim.Sex == 'Female' | 
                      Victim.Sex == 'Male' & Perpetrator.Age > 5 & Perpetrator.Age < 100),
      geom = 'boxplot', ylim = c(5,60))
```

Perpetrators of female victims are for the most part slightly older than perpetrators of male victims.

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_point() + 
  scale_x_continuous(limits = c(0, 95), breaks = seq(5,95,5)) +
  scale_y_continuous(limits = c(10, 95), breaks = seq(10,95,5))

```

There is some serious over plotting when looking at victim age to perpetrator ages in a scatter plot due to the size of our dataset.

```{r warning=FALSE}
#deal with overplotting
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_jitter(alpha = 1/20) + 
  scale_x_continuous(limits = c(0, 95), breaks = seq(5,95,5)) +
  scale_y_continuous(limits = c(10, 95), breaks = seq(10,95,5)) +
  coord_trans(y = 'sqrt')
```

There doesn't appear to be a particular relationship between victim age and perpetrator age. We see a clump of data points in the victim age 0-5 range, where perpetrator age ranges from 15-40 (mostly). From victim age 10 forward, there's a very vague positive relationship with perpetrator age. 

```{r warning=FALSE}
lm(formula = Victim.Age ~ Perpetrator.Age, data = subset(homicides, Perpetrator.Age <= 
     quantile(homicides$Perpetrator.Age, probs = c(.025,.975), na.rm = TRUE) & !is.na(Perpetrator.Age)))
```

```{r warning=FALSE}
#overlaying summaries with raw data
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = subset(homicides, Perpetrator.Age > 5)) + 
  geom_point(alpha = 1/20, position = position_jitter(h = 0), color = 'orange') + 
  coord_cartesian(xlim = c(0, 80), ylim = c(10,80)) +
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = .1), linetype = 2, color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = .5), color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(probs = .9), linetype = 2, color = 'blue')
```

The dashed lines are the 10th and 90th percentiles. The black solid line is the mean, and the blue solid line is the median.

```{r warning=FALSE}
cor.test(homicides$Victim.Age, homicides$Perpetrator.Age)
```
When controlling for errors in the data, the correlation between victim age and perpetrator age increases from what we saw earlier, to .38. 

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_point(alpha = 1/20, position = position_jitter(h = 0)) + 
  coord_cartesian(xlim = c(0, 80), ylim = c(5,80)) +
  geom_smooth(method = 'lm', color = 'orange')
```

Drawing a linear model line through the victim and perpetrator ages scatter plot shows a weak alignment with the data.

```{r warning=FALSE}
#conditional means
hom.vicperpage <- homicides %>%
  group_by(Victim.Age) %>%
  summarise(perpage_mean = mean(Perpetrator.Age),
            perpage_median = median(Perpetrator.Age),
            n = n()) %>%
  arrange(Victim.Age)

head(hom.vicperpage, 10)

ggplot(aes(x = Victim.Age, y = perpage_mean), data = hom.vicperpage) +
  geom_line() +
  scale_x_continuous(limits = c(0,95), breaks = seq(0,95,5)) + 
  geom_smooth()

```

When we look at victim age by mean perpetrator age, we do see some what of a positive linear relationship when smoothed out over the inconsistencies in young victim ages.

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = age_diff), data = homicides) + 
  geom_jitter(alpha = 1/20)
```

As victim age increases, the age difference between perpetrator and victim decreases, and then continuously increases again in the opposite direction.

```{r warning=FALSE}
ggplot(aes(x = Perpetrator.Age, y = age_diff), data = homicides) + 
  geom_jitter(alpha = 1/20)
```

As perpetrator age increases, age difference between perpetrator and victim decreases, and then increases again in opposite direction to form a continuous positive linear relationship.

```{r warning=FALSE}
qplot(x = Victim.Race, y = Year,
      data = homicides, geom = 'boxplot', fill = 'Orange') +
  theme(text = element_text(size=10))
```

```{r warning=FALSE}
#get summary stats on Year according to race
by(homicides$Year, homicides$Victim.Race, summary)
```
Across all known races, the median year in which homicides occurred is 1994-1997, with a majority of homicides occurring before 2006.

```{r warning=FALSE}
qplot(x = Weapon, y = Year,
      data = homicides, geom = 'boxplot') +
  theme(text = element_text(size = 12), axis.text.x = element_text(angle = 70))
```
```{r warning=FALSE}
#get summary stats on Year according to weapon
by(homicides$Year, homicides$Weapon, summary)
```
Homicides by drugs and unknown weapon have the most recent median years.

```{r warning=FALSE}
qplot(x = Victim.Race, y = Victim.Age,
      data = subset(homicides, Victim.Age < 100), geom = 'boxplot', ylim = c(0,100)) +
  theme(text = element_text(size=10))
```
```{r warning=FALSE}
#get summary stats on victim age according to race
by(homicides$Victim.Age, homicides$Victim.Race, summary)
```

Hispanic and Black races appear to have the smallest inter quartile range of ages in victims, which the majority of them occuring between 20/21 and 35/37 years old.

```{r warning=FALSE}
qplot(x = Perpetrator.Race, y = Perpetrator.Age,
      data = homicides, geom = 'boxplot', ylim = c(5,90)) +
  theme(text = element_text(size=10))
```

```{r warning=FALSE}
#get summary stats on perpetrator age according to race
by(homicides$Perpetrator.Age, homicides$Perpetrator.Race, summary)
```

Black and hispanic perpetrators are typically younger than those of other races, but not by much.

```{r warning=FALSE}
qplot(x = Weapon, y = Victim.Age,
      data = homicides, geom = 'boxplot', ylim = c(0,65)) +
  theme(text = element_text(size=12),axis.text.x = element_text(angle = 70))
```

```{r warning=FALSE}
#get summary stats on victim age according to weapon
by(homicides$Victim.Age, homicides$Weapon, summary)
```

Several interesting observations when looking at victim age according to weapon used. The median drowning victims are age 3. Poison, suffocation, and blunt object have the largest inter quartile ranges in victim age. Handguns have the smalled inter quartile range in victim ages.

```{r warning=FALSE}
qplot(x = Weapon, y = Perpetrator.Age,
      data = homicides, geom = 'boxplot', ylim = c(5, 60)) +
  theme(text = element_text(size = 12),axis.text.x = element_text(angle = 70))
```
```{r warning=FALSE}
#get summary stats on perpetrator age according to weapon
by(homicides$Perpetrator.Age, homicides$Weapon, summary)
```
We see a bit more consistency in weapons when it comes to perpetrator age; with the exception of explosives, which has a much smaller inter quartile range of 26.75 - 31 years old.

```{r warning=FALSE}
qplot(x = Relation, y = Victim.Age,
      data = homicides, geom = 'boxplot', ylim = c(0,75)) +
  theme(text = element_text(size = 12),axis.text.x = element_text(angle = 70))
```
```{r warning=FALSE}
#get summary stats on victim age according to relation to the perpetrator
by(homicides$Victim.Age, homicides$Relation, summary)
```

Most victims who are the child or stepchild of the perpetrator are of age 11 or under. Most victims who are the parent or stepparent of the perpetrator are of 45 - 66. Those killed by a stranger or an unknown perpetrator are typically of age 22 - 42.

```{r warning=FALSE}
qplot(x = Relation, y = Perpetrator.Age,
      data = homicides, geom = 'boxplot', ylim = c(5,60)) +
  theme(text = element_text(size=12),axis.text.x = element_text(angle = 70))
```
```{r warning=FALSE}
#get summary stats on perpetrator age according to relation to the victim
by(homicides$Perpetrator.Age, homicides$Relation, summary)
```

Perpetrator ages according to relationship with their victim has a more consistent pattern, with most of them tending to be between the ages of 20 and 40, roughly.

```{r warning=FALSE}
#conditional means
hom.vic_race_age <- homicides %>%
  group_by(Victim.Race) %>%
  summarise(vic.age_mean = mean(Victim.Age),
            vic.age_median = median(Victim.Age),
            n = n()) %>%
  arrange(Victim.Race)

head(hom.vic_race_age)
```

```{r warning=FALSE}
hom.state_vic <- subset(homicides, Victim.Age <= 
     quantile(homicides$Victim.Age, (.99), na.rm = TRUE)) %>%
  group_by(State) %>%
  summarise(vic.age_mean = mean(Victim.Age),
            vic.age_median = median(Victim.Age),
            n = n()) %>%
  arrange(desc(n))

head(hom.state_vic)
```

```{r warning=FALSE}
hom.year_vic <- subset(homicides, Victim.Age <= 
     quantile(homicides$Victim.Age, (.99), na.rm = TRUE)) %>%
  group_by(Year) %>%
  summarise(vic.age_mean = mean(Victim.Age),
            vic.age_median = median(Victim.Age),
            n = n()) %>%
  arrange(Year)

head(hom.year_vic)

ggplot(aes(x = Year, y = vic.age_median), data = hom.year_vic) +
  geom_line() +
  scale_y_continuous(limits = c(25,35))
```

There is no real trend in average victim age over the years, it stays in the range of 28 to 31.

```{r warning=FALSE}
hom.month_vic <- subset(homicides, Victim.Age <= 
     quantile(homicides$Victim.Age, (.99), na.rm = TRUE)) %>%
  group_by(Month) %>%
  summarise(vic.age_mean = mean(Victim.Age),
            vic.age_median = median(Victim.Age),
            n = n()) %>%
  arrange(Month)

head(hom.month_vic, 12)
```

```{r warning=FALSE}
hom.weapon_vic <- subset(homicides, Victim.Age <= 
     quantile(homicides$Victim.Age, (.99), na.rm = TRUE)) %>%
  group_by(Weapon) %>%
  summarise(vic.age_mean = mean(Victim.Age),
            vic.age_median = median(Victim.Age),
            n = n()) %>%
  arrange(Weapon)

head(hom.weapon_vic, 13)
```

```{r warning=FALSE}
hom.state_vic <- subset(homicides, Victim.Age <= 
     quantile(homicides$Victim.Age, (.99), na.rm = TRUE)) %>%
  group_by(State, State.Pop) %>%
  summarise(vic.age_mean = mean(Victim.Age),
            vic.age_median = median(Victim.Age),
            n = n()) %>%
  arrange(desc(n))

head(hom.state_vic) 
```

```{r warning=FALSE}
#homicide rate
hom.state_vic$hom_rate <- hom.state_vic$n/hom.state_vic$State.Pop

#plot homicide rates by state
ggplot(aes(reorder(State, -hom_rate), hom_rate), data = hom.state_vic) +
  geom_bar(position = 'dodge', stat = 'identity') +
  theme(text = element_text(size = 10),axis.text.x = element_text(angle = 90, hjust = 1))
```

Louisiana and South Carolina have the highest homicide rates.


## Bivariate Analysis

### Looking at some of the relationships observed in this part of the investigation, how did our features of interest vary with other features in the dataset?

Victim age and perpetrator age have pretty strong correlations with age difference. There are some trends in victim and perpetrator age when we look at them according to relationship between the victim and perpetrator as well. For example, when the victim is the child or stepchild of the perpetrator, the victim is typically age 11 or under, with a median age of 3. The perpetrator in these cases is typically age 19 to 36, which makes sense when we think of parents killing their children. When looking at perpetrators that are the child or stepchild of the victim, they are typically aged 23 to 39 and when looking at victims that are the parent or stepparent of the perpetrator, they are typically aged 45 to 66.

When it comes to race, both perpetrators and victims have a smaller window in age range when the homicide occurs, typically from age 20 to mid 30s. These two races also have median ages that are slightly lower than other races in both victims and perpetrators.

In gender, we see that female perpetrators are typically slightly older than male perpetrators. We also see that female victims typically have slightly older perpetrators than male victims.

We see some interesting trends in weapon used in the homicide for victims. Those killed by drowning or suffocation have median victim ages quite a bit lower than victims killed by other weapons. Perpetrators using explosives as their weapon are for the most part between ages 26 and 31. Overall though, there isn't much of a trend in weapons used when looking at perpetrator ages.

### Did we observe any interesting relationships between the other features (not the main features of interest)?

The number times a homicide of a certain race occurs in a certain year doesn't indicate any certain trend. It does show that across the board, the majority of homicides occurred before 2006.

The median year for homicides by all weapons is early to mid 90s, with the exception of drugs, suffocation, and unknown weapon. The homicide weapon with the most recent median year is drugs, which is 2004.

The states of Louisiana, South Carolina, and Arkansas had the highest homicide rates. This is interesting because they are not very populated states.

### What was the strongest relationship we found?

The strongest relationship we found was the age of victims who are the child or stepchild of the perpetrator and the age of victims killed by drowning or suffocation. It leads us to want to look further into the idea that young victims have a higher likelihood of being killed by a parent with the method of drowning or suffocation.

## Multivariate Plots Section

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age),
       data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) +
  geom_line(aes(color = Victim.Sex), stat = 'summary', fun.y = median) +
  coord_cartesian(xlim = c(0, 90), ylim = c(10,60))
```

For nearly all victim ages, the median male perpetrator age is lower than median female perpetrator age.

```{r warning=FALSE}
ggplot(aes(x = Relation), data = homicides) +
  geom_bar(aes(y = ..count../(sum(..count..))), fill = I('#099DD9')) +
  theme(text = element_text(size=10), axis.text.x = element_text(angle = 70)) +
  scale_y_continuous(labels = scales::percent) +
  facet_wrap(~ Crime.Solved)
```

Looking at the rate which crimes are solved according to relation, we don't see any trends as across the board, unsolved crimes are pretty low. This could be because we removed the data that had seemingly erroneous victim or perpetrator ages, which could have also been unsolved murders.

```{r warning=FALSE}
ggplot(aes(Year), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) +
  stat_density(aes(group = Victim.Race, color = Victim.Race),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'Greens') +
  theme_dark() +
  facet_wrap(~ Victim.Sex, ncol = 1)
```

```{r warning=FALSE}
p1 <- ggplot(aes(Year), data = subset(homicides, Weapon == 'Handgun' | 
                                              Weapon == 'Other Firearm' | Weapon == 'Knife' | Weapon == 'Blunt Object'
                                            | Weapon == 'Unknown' | Weapon == 'Strangulation')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  scale_color_brewer(type = 'seq', palette = 'Blues') +
  theme_dark()

p2 <- ggplot(aes(Year), data = subset(homicides, Weapon == 'Fire' | Weapon == 'Suffocation' | Weapon == 'Drugs' | 
                                        Weapon == 'Drowning' | Weapon == 'Poison' | Weapon == 'Fall')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  scale_color_brewer(type = 'seq', palette = 'BuGn') +
  theme_dark()

p3 <- ggplot(aes(Year), data = subset(homicides, Weapon == 'Explosives')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  theme_dark()

grid.arrange(p1, p2, p3, ncol=1)
```

```{r warning=FALSE}
ggplot(aes(Year), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) +
  stat_density(aes(group = Relation, color = Relation),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'Oranges') +
  theme_dark() +
  facet_wrap(~ Victim.Sex, ncol = 1)
```

Homicides by strangulation and falls have decreased over the years, those by drugs have increased, and explosives experienced a big spike in the mid 90s. Homicides of black females, hispanic males and male spouses/ex-spouses have experienced the largest decline over the years. 

```{r warning=FALSE}
ggplot(aes(Victim.Age), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) +
  stat_density(aes(group = Victim.Race, color = Victim.Race),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'Purples') +
  theme_dark() +
  facet_wrap(~ Victim.Sex, ncol = 1)
```

```{r warning=FALSE}
ggplot(aes(Victim.Age), data = subset(homicides, Perpetrator.Sex == 'Female' | Perpetrator.Sex == 'Male')) +
  stat_density(aes(group = Relation, color = Relation),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'Reds') +
  theme_dark() +
  facet_wrap(~ Perpetrator.Sex, ncol = 1)
```

```{r warning=FALSE}
p1 <- ggplot(aes(Victim.Age), data = subset(homicides, Weapon == 'Handgun' | 
                                              Weapon == 'Other Firearm' | Weapon == 'Knife' | Weapon == 'Blunt Object'
                                            | Weapon == 'Unknown' | Weapon == 'Strangulation')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'BuGn') +
  theme_dark()

p2 <- ggplot(aes(Victim.Age), data = subset(homicides, Weapon == 'Fire' | 
                                              Weapon == 'Suffocation' | Weapon == 'Drugs' | Weapon == 'Drowning'
                                            | Weapon == 'Explosives' | Weapon == 'Poison' | Weapon == 'Fall')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'OrRd') +
  theme_dark()

grid.arrange(p1, p2, ncol=1)
```

As we've seen in earlier sections, drowning is the highest density cause of death in homicides of young children, and here we see that more of the perpetrators in those crimes are female parents. Handgun is most common for victims aged around 20-30, and drowning is most common for victims aged 0-5. Hispanic male victims make up the highest amount of victims aged 20-25.

```{r warning=FALSE}
ggplot(aes(Perpetrator.Age), data = subset(homicides, Perpetrator.Sex == "Female" | Perpetrator.Sex == "Male")) +
  stat_density(aes(group = Perpetrator.Race, color = Perpetrator.Race),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'PuBu') +
  theme_dark() +
  facet_wrap(~Perpetrator.Sex, ncol = 1)
```
```{r warning=FALSE}
ggplot(aes(Perpetrator.Age), data = subset(homicides, Perpetrator.Sex == "Female" | Perpetrator.Sex == "Male")) +
  stat_density(aes(group = Relation, color = Relation),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'YlGnBu') +
  theme_dark() +
  facet_wrap(~Perpetrator.Sex, ncol = 1)
```

```{r warning=FALSE}
p1 <- ggplot(aes(Perpetrator.Age), data = subset(homicides, Weapon == 'Handgun' | 
                                              Weapon == 'Other Firearm' | Weapon == 'Knife' | Weapon == 'Blunt Object'
                                            | Weapon == 'Unknown' | Weapon == 'Strangulation')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  scale_color_brewer(type = 'seq', palette = 'RdPu') +
  theme_dark()

p2 <- ggplot(aes(Perpetrator.Age), data = subset(homicides, Weapon == 'Fire' | 
                                              Weapon == 'Suffocation' | Weapon == 'Drugs' | Weapon == 'Drowning'
                                            | Weapon == 'Poison' | Weapon == 'Fall')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  scale_color_brewer(type = 'seq', palette = 'YlGn') +
  theme_dark()

p3 <- ggplot(aes(Perpetrator.Age), data = subset(homicides, Weapon == 'Explosives')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  theme_dark()

grid.arrange(p1, p2, p3, ncol=1)
```

Perpetrators who murder their child or stepchild are mostly made up of females under 25. Perpetrators who kill by drowning are mostly under age 25. As we saw in earlier sections, perpetrators who use explosives to commit homicide are highly concentrated in ages about 26-30. Most black and white perpetrators are under age 25.

```{r warning=FALSE}
#make buckets for victim and perpetrator ages as following: (0/1,18], (18,25], (25,30], (30,35], (35,45], (45,55], (55,65], (65,75]
homicides$Victim.Age.bucket <- cut(homicides$Victim.Age, breaks = c(0,18,25,30,35,45,55,65,95))
homicides$Perpetrator.Age.bucket <- cut(homicides$Perpetrator.Age, breaks = c(5,18,25,30,35,45,55,65,95))
table(homicides$Victim.Age.bucket)
table(homicides$Perpetrator.Age.bucket)
```
Buckets for victim and perpetrator age ranges.

```{r warning=FALSE}
qplot(x = Victim.Age.bucket, y = age_diff,
      data = homicides, geom = 'boxplot') +
  theme(text = element_text(size=12))
```
```{r warning=FALSE}
by(homicides$age_diff, homicides$Victim.Age.bucket, summary)
```

```{r warning=FALSE}
qplot(x = Perpetrator.Age.bucket, y = age_diff,
      data = homicides, geom = 'boxplot') +
  theme(text = element_text(size=12))
```
```{r warning=FALSE}
by(homicides$age_diff, homicides$Perpetrator.Age.bucket, summary)
```

There are trends in the age difference between victim and perpetrator based on what age bucket the victim or perpetrator fall in. For victims 18 and under, their perpetrators are for the most part 2 - 22 years older than them. For victims 55 - 65 years old, their perpetrators are for the most part 35 - 8 years younger than them. For perpetrators between 18 and 25 years old, their victims are for the most part between 12 years older and 2 years younger than them.

```{r warning=FALSE}
dim(homicides)
hom_same_race <- subset(homicides, Victim.Race == Perpetrator.Race)
dim(hom_same_race)
dim(hom_same_race)/dim(homicides)
```
84% of homicides occur within one race, meaning the victim and perpetrator races are the same.

```{r warning=FALSE}
dim(homicides)
hom_same_sex <- subset(homicides, Victim.Sex == Perpetrator.Sex)
dim(hom_same_sex)
dim(hom_same_sex)/dim(homicides)
```
68% of homicides have victims and perpetrators of the same sex.

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_point(aes(color = Victim.Race), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'RdBu',
    guide = guide_legend(title = 'Victim.Race', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  ylim(5, 90) +
  theme_gray()
```

```{r fig.width=9, fig.height=4.5, warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_point(aes(color = Victim.Race), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'RdBu',
    guide = guide_legend(title = 'Victim.Race', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  ylim(5, 90) +
  facet_wrap(~Relation) +
  ggtitle('Facet wrap by Relation') +
  theme_gray() +
  geom_smooth()
```

```{r fig.width=11, fig.height=6, warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_point(aes(color = Victim.Race), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'RdBu',
    guide = guide_legend(title = 'Victim.Race', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  ylim(5, 90) +
  facet_wrap(~Weapon) +
  ggtitle('Facet wrap by Weapon') + 
  theme_gray() +
  geom_smooth()
```

Race clustered by ages and faceted by weapon and relation. There don't appear to be any super clear trends. Generally, black victims seem to be younger than white victims - but the pattern is not very strong. Most homicides between employee/employers seems to have white victims. There does appear to be an age pattern in sibling homicides, positive and linear. Homicides involving drugs seem to have mainly white victims.

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_point(aes(color = Relation), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'RdBu',
    guide = guide_legend(title = 'Relation', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  theme_dark() +
  scale_x_continuous(limits = c(0, 90), breaks = c(10,20,30,40,50,60,70,80)) + 
  scale_y_continuous(limits = c(5, 90), breaks = c(10,20,30,40,50,60,70,80))
```

```{r fig.width=11, fig.height=6, warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = homicides) + 
  geom_point(aes(color = Relation), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'RdBu',
    guide = guide_legend(title = 'Relation', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  ylim(5, 90) +
  facet_wrap(~Weapon) +
  ggtitle('Facet wrap by Weapon') +
  theme_dark() +
  geom_smooth()
```

Looking at victim and perpetrator ages colored by relation, we see a cluster of child/stepchild homicides around victim age 0-10 and perpetrator age 20-40. There's a small cluster of sibling homicides around victim age 0-10 and perpetrator age 5-15. There's another small cluster of parent/stepparent homicides around victim age 70-90 and perpetrator age 40-60. There don't appear to be any clear trends in relation faceted by weapon. There's a more noticeable cluster of child/stepchild homicides in drugs, drowning, poison, suffocation, fire and blunt object.

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) + 
  geom_point(aes(color = Victim.Sex), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'Reds',
    guide = guide_legend(title = 'Victim.Sex', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  ylim(5, 90) +
  theme_dark() +
  facet_wrap(~Relation) +
  ggtitle('Facet wrap by Relation') +
  geom_smooth()
```

```{r fig.width=11, fig.height=6, warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) + 
  geom_point(aes(color = Victim.Sex), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'Reds',
    guide = guide_legend(title = 'Victim.Sex', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  ylim(5, 90) +
  theme_dark() +
  facet_wrap(~Weapon) +
  ggtitle('Facet wrap by Weapon') +
  geom_smooth()
```

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = Perpetrator.Age), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male')) + 
  geom_point(aes(color = Victim.Sex), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'Reds',
    guide = guide_legend(title = 'Victim.Sex', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  ylim(5, 90) +
  theme_dark()
  
```

Looking at victim and perpetrator ages colored by sex and faceted by relation: homicides of siblings have large number of male victims and relationship is strong, linear and positive. Spouse and significant other homicides have a large number of female victims. Faceted by weapon, strangulation and suffocation have a higher concentration of female victims. Overall, female victims appear to be concentrated in the older victim and perpetrator ages. Male victims seem to be concentrated in the younger victim ages.

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = age_diff), data = homicides) + 
  geom_point(aes(color = Victim.Race), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'BrBG',
    guide = guide_legend(title = 'Victim.Race', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  scale_x_continuous(limits = c(0, 90), breaks = c(10,20,30,40,50,60,70,80))
```

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = age_diff), data = homicides) + 
  geom_point(aes(color = Relation), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'BrBG',
    guide = guide_legend(title = 'Relation', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  theme_grey() +
  scale_x_continuous(limits = c(0, 90), breaks = c(10,20,30,40,50,60,70,80)) +
  scale_y_continuous(breaks = c(-50,-40,-30,-20,-10,0,10,20,30,40,50,60))
```

```{r warning=FALSE}
ggplot(aes(x = Victim.Age, y = age_diff), data = homicides) + 
  geom_point(aes(color = Weapon), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'BrBG',
    guide = guide_legend(title = 'Weapon', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8))
```

We see the largest trend in victim age vs. age difference colored by Relation. There's a cluster of child/stepchild homicides at victim age 0-10 in which the age difference between victim and perpetrator is between 15 and 50. There's a small cluster of sibling homicides around victim age 0-10 and age difference 0-5. There's another cluster of parent/stepparent homicides at victim age 80+ and age difference 20-40.

```{r warning=FALSE}
ggplot(aes(x = Perpetrator.Age, y = age_diff), data = homicides) + 
  geom_point(aes(color = Perpetrator.Race), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'PRGn',
    guide = guide_legend(title = 'Perpetrator.Race', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  xlim(5, 90)
```

```{r warning=FALSE}
ggplot(aes(x = Perpetrator.Age, y = age_diff), data = homicides) + 
  geom_point(aes(color = Relation), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'PRGn',
    guide = guide_legend(title = 'Relation', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  xlim(5, 90)
```

The trends we see in the previous section comparing victim age and age difference are confirmed looking at perpetrator ages as well.

```{r warning=FALSE}
#graph Relation category of homicides based on young children victims
ggplot(aes(x = Relation), data = subset(homicides, Victim.Age < 5)) +
  geom_bar(aes(y = ..count../(sum(..count..))), fill = I('#099DD9')) +
  theme(text = element_text(size=10), axis.text.x = element_text(angle = 70)) +
  scale_y_continuous(labels = scales::percent)
```

Homicides of the child/stepchild of the perpetrator make up 60% of victims under 5 years old.

```{r warning=FALSE}
#graph Relation category of homicides based on young children victims
ggplot(aes(x = Weapon), data = subset(homicides, Victim.Age < 10 & Relation == 'Child/Stepchild')) +
  geom_bar(aes(y = ..count../(sum(..count..))), fill = I('#099DD9')) +
  theme(text = element_text(size=10), axis.text.x = element_text(angle = 70)) +
  scale_y_continuous(labels = scales::percent)
```

Over 50% of homicides of the perpetrator's child/stepchild under age 5 is done with a blunt object.

```{r warning=FALSE}
#install.packages('bitops')
#install.packages('RCurl')
#install.packages('scales')
#install.packages('memisc')
library('bitops')
library('RCurl')
library(scales)
library(memisc)

# create linear model to predict age of victim
m1 <- lm(formula = I(Victim.Age) ~ I(age_diff), data = homicides)
m2 <- update(m1, ~ . + Relation)
m3 <- update(m2, ~ . + Weapon)
m4 <- update(m3, ~ . + Perpetrator.Sex)

mtable(m1, m2, m3, m4)
```

The variables in this plot can account for 51.3% of the variance in the Victim's Age, which isn't very high. Age difference alone accounts for 49.4% of the variance in Victim's Age.

## Multivariate Analysis

### What are some of the relationships that were observed in this part of the investigation? Where there features that strengthened each other in terms of looking at your features of interest?

Child aged victims have a much higher proportion of female perpetrators of whom they are the child or stepchild. There is a higher amount of homicides by drowning of victims of child age. We also confirmed the high concentration of perpetrators aged 26-30 who use explosives to commit their homicides.

Victim age buckets that are 0-18 have all perpetrators older than them, from there as age buckets go higher, age difference gets closer to zero, and as we go higher in age buckets starting at 35-45, victims are pretty much all older than their perpetrators. 

In the colored scatter plots between victim age and perpetrator age, we see little clusters that identify aged of child/stepchild, sibling and parent/stepparent homicides, and the means by which those homicides occur. 

### Were there any interesting or surprising interactions between features?

It was surprising to see the large proportion of homicides by blunt object for those in which victims were age 0-5 and the child/stepchild of the perpetrator. Early plots would have us believe drowning would have taken the majority there.

### Did you create any models with your dataset? Discuss the strengths and limitations of your model.

I created a linear model starting from the victim age and age difference. 

The variables in the linear model account for 51.3% of the variance in the victim age. Relation, Weapon, and Perpetrator Sex slightly improve the R^2 value by 1.9% However, the model does not appear to account for significantly meaningful predictions in victim age.

## Final Plots and Summary

### Plot One

```{r warning=FALSE}
#Look at homicide rates in state with highest rate, Louisiana
ggplot(aes(Year), data = subset(homicides, Victim.Sex == 'Female' | Victim.Sex == 'Male' & State == 'Louisiana')) +
  stat_density(aes(group = Victim.Race, color = Victim.Race),position = "identity", geom = 'line') +
  theme(text = element_text(size = 10)) +
  scale_color_brewer(type = 'seq', palette = 'Blues') +
  theme_dark() +
  facet_wrap(~ Victim.Sex, ncol = 1) +
  ggtitle("Density of Year by Victim Race & Gender")
```

### Description One

Louisiana, the state with the highest homicide rates over the years in this dataset experienced a spike in homicides of hispanic males in the early to mid 80s.

### Plot Two

```{r warning=FALSE}
# create plots looking at weapon used over the years
p1 <- ggplot(homicides, aes(x = Weapon, y = Year)) +
  geom_boxplot(fill = "slateblue", alpha = 0.2) +
  theme(text = element_text(size = 8), axis.text.x = element_text(angle = 70)) +
  ggtitle("Years of Homicide Occurences by Weapon")

p2 <- ggplot(aes(Year), data = subset(homicides, Weapon == 'Explosives')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  theme_grey() +
  ggtitle("Density of Year by Explosives as Weapon")

grid.arrange(p1, p2, ncol = 1)
```
```{r warning=FALSE}
#create plots looking weapon used for perpetrator ages
p3 <- ggplot(homicides, aes(x = Weapon, y = Perpetrator.Age)) +
  geom_boxplot(fill = "slateblue", alpha = 0.2) +
  theme(text = element_text(size = 8),axis.text.x = element_text(angle = 70)) +
  ylim(5,70) +
  ggtitle("Perpetrator Ages by Weapon")

p4 <- ggplot(aes(Perpetrator.Age), data = subset(homicides, Weapon == 'Explosives')) +
  stat_density(aes(group = Weapon, color = Weapon),position = "identity", geom = 'line') +
  theme(text = element_text(size = 8)) +
  theme_dark() +
  ggtitle("Density of Perpetrator Age by Explosives as Weapon")

grid.arrange(p3, p4, ncol = 1)
```

### Description Two

The mid 90s saw a huge concentration of homicides by explosives with a narrow majority age range of around 26-30. Were there some events in those years that can explain these spikes? We do know that the Oklahoma City bombing was in 1995 and the perpetrator was in his mid-late 20s.

### Plot Three

```{r warning=FALSE}
#compare victim age and age difference by relation of Child/Stepchild and Parent/Stepparent
ggplot(aes(x = Victim.Age, y = age_diff), data = subset(homicides, Relation == 'Child/Stepchild' | Relation == 'Parent/Stepparent')) + 
  geom_point(aes(color = Relation), alpha = 0.5, size = 1, position = 'jitter') +
  scale_color_brewer(type = 'div', palette = 'Reds',
    guide = guide_legend(title = 'Relation', reverse = T,
    override.aes = list(alpha = 1, size = 2))) +
  theme(text = element_text(size = 8)) +
  scale_x_continuous(limits = c(0, 90), breaks = c(10,20,30,40,50,60,70,80)) +
  scale_y_continuous(name = "Age Difference betwee Vic & Perp", limits = c(-60,60), breaks = c(-50,-40,-30,-20,-10,0,10,20,30,40,50,60)) +
  ggtitle("Age Difference by Victim Age and Relation") +
  geom_smooth() +
  theme_gray()
```

### Description Three

There's a concentration of child/stepchild homicides at victim age 0-10 in which the age difference between victim and perpetrator is between 15 and 50. There's another cluster of parent/stepparent homicides at victim age 40-70 and age difference 20-40.

## Reflection

The homicides dataset contains information on almost 640,000 homicides in the United States from 1980 - 2014. I started by understanding some of the individual variables in the data set and further explored them in relation to one another to gather insights of what trends might be there. Later on, I was able to observe trends in pockets of the data and created a linear model to predict victim age.

The linear model didn't quite provide a clear trend or ability to predict victim age. I think this had something to do with needing to section of the data into subsets and then perform these models. For example, as we saw in the third plot of our final section, there are clusters/pockets of data in which homicides of victims within a certain age range, age difference between them and perpetrator, and the relation they have with each other.

There were limitations in the data on account of unsolved murders. It prevented us from gaining information about the perpetrators in those cases. It also seemed that for unsolved homicides, there were erroneous or random entries in the ages of the perpetrator and even the victim. We removed the data where the ages were erroneous to prevent it from getting in the way of our analyses.

## References
http://ggplot2.tidyverse.org/reference/scale_brewer.html

http://t-redactyl.io/blog/2016/04/creating-plots-in-r-using-ggplot2-part-10-boxplots.html

https://www.r-graph-gallery.com/

```{r echo=FALSE, message=FALSE, warning=FALSE}

#install.packages('knitr', dependencies = T)
#library(knitr)
```
